<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kimi Claw æ§åˆ¶å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #888;
            font-size: 0.9rem;
        }
        
        .last-update {
            color: #666;
            font-size: 0.8rem;
            margin-top: 10px;
        }
        
        .status-bar {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px 25px;
            min-width: 150px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(233, 69, 96, 0.2);
        }
        
        .status-card .label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .status-card .value {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .status-card.online .value {
            color: #4ade80;
        }
        
        .status-card.offline .value {
            color: #ef4444;
        }
        
        .section {
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        
        .section-title {
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #e94560, #ff6b6b);
            border-radius: 2px;
        }
        
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .task-item {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: background 0.2s;
        }
        
        .task-item:hover {
            background: rgba(255,255,255,0.08);
        }
        
        .task-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .task-status.active {
            background: #4ade80;
            box-shadow: 0 0 10px #4ade80;
        }
        
        .task-status.scheduled {
            background: #fbbf24;
        }
        
        .task-status.completed {
            background: #6b7280;
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-name {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .task-meta {
            font-size: 0.8rem;
            color: #888;
        }
        
        .task-schedule {
            font-size: 0.8rem;
            color: #aaa;
            background: rgba(255,255,255,0.05);
            padding: 4px 10px;
            border-radius: 20px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e94560, #ff6b6b);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(233, 69, 96, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .refresh-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(233, 69, 96, 0.5);
        }
        
        .refresh-btn.spinning {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-top-color: #e94560;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.5rem; }
            .status-card { min-width: 120px; padding: 15px 20px; }
            .section { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>â¤ï¸â€ğŸ”¥ Kimi Claw æ§åˆ¶å°</h1>
            <p class="subtitle">è¿è¡ŒçŠ¶æ€ä¸ä»»åŠ¡ç®¡ç†</p>
            <p class="last-update" id="lastUpdate">æ•°æ®æ›´æ–°äº: åŠ è½½ä¸­...</p>
        </header>
        
        <div class="status-bar" id="statusBar">
            <div class="status-card online">
                <div class="label">è¿è¡ŒçŠ¶æ€</div>
                <div class="value" id="statusValue">åŠ è½½ä¸­...</div>
            </div>
            <div class="status-card">
                <div class="label">å½“å‰æ¨¡å‹</div>
                <div class="value" id="modelValue">-</div>
            </div>
            <div class="status-card">
                <div class="label">æ´»è·ƒä¼šè¯</div>
                <div class="value" id="sessionsValue">-</div>
            </div>
            <div class="status-card">
                <div class="label">å®šæ—¶ä»»åŠ¡</div>
                <div class="value" id="cronValue">-</div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">å®šæ—¶ä»»åŠ¡ (Cron)</h2>
            <div class="task-list" id="cronList">
                <div class="empty-state">
                    <div class="empty-state-icon">â³</div>
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">æ´»è·ƒä¼šè¯</h2>
            <div class="task-list" id="sessionsList">
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ’¬</div>
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>
    </div>
    
    <button class="refresh-btn" id="refreshBtn" onclick="refreshData()">â†»</button>
    
    <script>
        // é…ç½®
        const CONFIG = {
            // æ•°æ®æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äºé¡µé¢ä½ç½®ï¼‰
            dataPath: './',
            refreshInterval: 30000 // 30ç§’è‡ªåŠ¨åˆ·æ–°
        };
        
        let lastDataTimestamp = null;
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timestamp) {
            if (!timestamp) return '-';
            const date = new Date(timestamp);
            return date.toLocaleString('zh-CN', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // æ ¼å¼åŒ–ç›¸å¯¹æ—¶é—´
        function timeAgo(timestamp) {
            if (!timestamp) return '-';
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'åˆšåˆš';
            if (seconds < 3600) return `${Math.floor(seconds / 60)} åˆ†é’Ÿå‰`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)} å°æ—¶å‰`;
            return `${Math.floor(seconds / 86400)} å¤©å‰`;
        }
        
        // è·å–ç½‘å…³çŠ¶æ€
        async function fetchGatewayStatus() {
            try {
                const response = await fetch(CONFIG.dataPath + 'status_data.json?t=' + Date.now());
                if (!response.ok) throw new Error('è·å–çŠ¶æ€å¤±è´¥');
                return await response.json();
            } catch (e) {
                console.log('çŠ¶æ€æ•°æ®ä¸å¯ç”¨ï¼Œä½¿ç”¨é»˜è®¤å€¼');
                return { status: 'online', model: 'kimi-coding/k2p5' };
            }
        }
        
        // è·å– Cron ä»»åŠ¡åˆ—è¡¨
        async function fetchCronJobs() {
            try {
                const response = await fetch(CONFIG.dataPath + 'cron_data.json?t=' + Date.now());
                if (!response.ok) throw new Error('è·å–ä»»åŠ¡å¤±è´¥');
                return await response.json();
            } catch (e) {
                console.log('Cron æ•°æ®ä¸å¯ç”¨');
                return { jobs: [] };
            }
        }
        
        // è·å–ä¼šè¯åˆ—è¡¨
        async function fetchSessions() {
            try {
                const response = await fetch(CONFIG.dataPath + 'sessions_data.json?t=' + Date.now());
                if (!response.ok) throw new Error('è·å–ä¼šè¯å¤±è´¥');
                return await response.json();
            } catch (e) {
                console.log('ä¼šè¯æ•°æ®ä¸å¯ç”¨');
                return { sessions: [] };
            }
        }
        
        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                'æ•°æ®æ›´æ–°äº: ' + now.toLocaleString('zh-CN');
        }
        
        // æ›´æ–°çŠ¶æ€æ 
        function updateStatusBar(data) {
            const statusValue = document.getElementById('statusValue');
            const modelValue = document.getElementById('modelValue');
            
            if (data && data.status !== 'offline') {
                statusValue.textContent = 'åœ¨çº¿';
                statusValue.parentElement.classList.add('online');
                statusValue.parentElement.classList.remove('offline');
                modelValue.textContent = data.model || 'kimi-coding/k2p5';
            } else {
                statusValue.textContent = 'ç¦»çº¿';
                statusValue.parentElement.classList.remove('online');
                statusValue.parentElement.classList.add('offline');
                modelValue.textContent = data?.model || '-';
            }
        }
        
        // æ›´æ–° Cron ä»»åŠ¡åˆ—è¡¨
        function updateCronList(data) {
            const container = document.getElementById('cronList');
            const jobs = data.jobs || [];
            
            document.getElementById('cronValue').textContent = jobs.length;
            
            if (jobs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <p>æš‚æ— å®šæ—¶ä»»åŠ¡</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = jobs.map(job => {
                const isEnabled = job.enabled !== false;
                const scheduleText = job.schedule ? formatSchedule(job.schedule) : 'æœªçŸ¥';
                const nextRun = job.state?.nextRunAtMs ? formatTime(job.state.nextRunAtMs) : '-';
                
                return `
                    <div class="task-item">
                        <div class="task-status ${isEnabled ? 'active' : 'completed'}"></div>
                        <div class="task-info">
                            <div class="task-name">${job.name || 'æœªå‘½åä»»åŠ¡'}</div>
                            <div class="task-meta">ä¸‹æ¬¡è¿è¡Œ: ${nextRun}</div>
                        </div>
                        <div class="task-schedule">${scheduleText}</div>
                    </div>
                `;
            }).join('');
        }
        
        // æ ¼å¼åŒ–è°ƒåº¦è§„åˆ™
        function formatSchedule(schedule) {
            if (schedule.kind === 'every') {
                const minutes = Math.floor(schedule.everyMs / 60000);
                if (minutes < 60) return `æ¯ ${minutes} åˆ†é’Ÿ`;
                const hours = Math.floor(minutes / 60);
                if (hours < 24) return `æ¯ ${hours} å°æ—¶`;
                return `æ¯ ${Math.floor(hours / 24)} å¤©`;
            }
            if (schedule.kind === 'cron') {
                if (schedule.expr === '0 10 * * *') return 'æ¯å¤© 10:00';
                if (schedule.expr === '0 20 * * *') return 'æ¯å¤© 20:00';
                return `Cron: ${schedule.expr}`;
            }
            if (schedule.kind === 'at') {
                return formatTime(new Date(schedule.at).getTime());
            }
            return JSON.stringify(schedule);
        }
        
        // æ›´æ–°ä¼šè¯åˆ—è¡¨
        function updateSessionsList(data) {
            const container = document.getElementById('sessionsList');
            const sessions = data.sessions || [];
            
            document.getElementById('sessionsValue').textContent = sessions.length;
            
            if (sessions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’¤</div>
                        <p>æš‚æ— æ´»è·ƒä¼šè¯</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = sessions.slice(0, 10).map(session => {
                const lastActive = session.lastMessageAt || session.updatedAt;
                return `
                    <div class="task-item">
                        <div class="task-status active"></div>
                        <div class="task-info">
                            <div class="task-name">${session.label || session.sessionKey || 'æœªå‘½åä¼šè¯'}</div>
                            <div class="task-meta">${session.kind || 'unknown'} Â· ${timeAgo(lastActive)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // åˆ·æ–°æ‰€æœ‰æ•°æ®
        async function refreshData() {
            const btn = document.getElementById('refreshBtn');
            btn.classList.add('spinning');
            
            try {
                // å¹¶è¡Œè·å–æ‰€æœ‰æ•°æ®
                const [gatewayStatus, cronData, sessionsData] = await Promise.all([
                    fetchGatewayStatus(),
                    fetchCronJobs(),
                    fetchSessions()
                ]);
                
                updateStatusBar(gatewayStatus);
                updateCronList(cronData);
                updateSessionsList(sessionsData);
                updateLastUpdateTime();
                
            } catch (error) {
                console.error('åˆ·æ–°å¤±è´¥:', error);
            } finally {
                btn.classList.remove('spinning');
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            refreshData();
            // è‡ªåŠ¨åˆ·æ–°
            setInterval(refreshData, CONFIG.refreshInterval);
        });
    </script>
</body>
</html>
